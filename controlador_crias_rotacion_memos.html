<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Controlador de Crías – Inspección 6ta Zona</title>
<style>
body { font-family: Arial, sans-serif; background:#f2f2f2; margin:0 }
header { background:#1f2a44; color:#fff; padding:20px; text-align:center }
.container { max-width:1100px; margin:auto; background:#fff; padding:25px }
.controls { display:flex; gap:10px; margin-bottom:15px; flex-wrap:wrap }
button { padding:6px 10px; cursor:pointer }
table { width:100%; border-collapse:collapse; margin-top:15px }
th,td { border:1px solid #000; padding:6px }
th { background:#e6e6e6 }
.memoria { border:1px solid #000; padding:12px; margin-bottom:20px }
.saved { margin-top:30px }
.saved ul { padding-left:20px }
.saved li { margin-bottom:6px }
@media print { header,.controls,.saved { display:none } }
</style>
</head>
<body>

<header>
<h2>CONTROLADOR DE COMISARÍAS</h2>
<h3>Inspección 6ta Zona</h3>
</header>

<div class="container" id="contenido">

<div class="controls">
<select id="mes">
<option value="0">Enero</option><option value="1">Febrero</option>
<option value="2">Marzo</option><option value="3">Abril</option>
<option value="4">Mayo</option><option value="5">Junio</option>
<option value="6">Julio</option><option value="7">Agosto</option>
<option value="8">Septiembre</option><option value="9">Octubre</option>
<option value="10">Noviembre</option><option value="11">Diciembre</option>
</select>
<input type="number" id="anio" value="2026">
<button onclick="generar()">Generar</button>
<button onclick="guardar()">Guardar memo</button>
<button onclick="window.print()">Imprimir / PDF</button>
</div>

<div class="memoria">
<b>MEMORANDUM</b><br><br>
SEÑORES JEFES DE: C.R.I.A. 27°, C.R.E.A.S., SUB CRIA 7°, SUB CRIA 9°, 
SUB CRIA 10°, SUB CRIA 11°, SUB CRIA 12°.<br><br>
Horario: 22:00 a 06:00 hs.
</div>

<h3 id="titulo"></h3>

<table>
<thead>
<tr><th>Día</th><th>Fecha</th><th>Dependencia</th></tr>
</thead>
<tbody id="tabla"></tbody>
</table>

<div class="saved">
<h3>Memorándums guardados</h3>
<ul id="lista"></ul>
</div>

</div>

<script>
const dependencias = ["CRIA 27","CREAS","SUB CRIA 7","SUB CRIA 9","SUB CRIA 10","SUB CRIA 11","SUB CRIA 12"];
const dias = ["Domingo","Lunes","Martes","Miércoles","Jueves","Viernes","Sábado"];
const prohibidasFinde = ["CRIA 27","CREAS"];
const diasFinde = [0,5,6];

function generar(){
 const mes = +document.getElementById("mes").value;
 const anio = +document.getElementById("anio").value;
 const tabla = document.getElementById("tabla");
 const titulo = document.getElementById("titulo");
 tabla.innerHTML = "";

 const usados = {};
 dependencias.forEach(d=>usados[d]=new Set());

 let idx = parseInt(localStorage.getItem("rotacion_idx")) || 0;
 const total = new Date(anio,mes+1,0).getDate();

 const nombreMes = new Date(anio,mes).toLocaleString("es",{month:"long"}).toUpperCase();
 titulo.innerText = `MES DE ${nombreMes} ${anio}`;

 for(let d=1; d<=total; d++){
   const fecha = new Date(anio,mes,d);
   const dia = fecha.getDay();
   let elegido = null;

   for(let i=0;i<dependencias.length;i++){
     const dep = dependencias[(idx+i)%dependencias.length];
     if(!usados[dep].has(dia) && !(prohibidasFinde.includes(dep) && diasFinde.includes(dia))){
       elegido = dep;
       idx = (idx+i+1)%dependencias.length;
       break;
     }
   }

   if(!elegido){
     for(let i=0;i<dependencias.length;i++){
       const dep = dependencias[(idx+i)%dependencias.length];
       if(!(prohibidasFinde.includes(dep) && diasFinde.includes(dia))){
         elegido = dep;
         idx = (idx+i+1)%dependencias.length;
         break;
       }
     }
   }

   usados[elegido].add(dia);
   tabla.innerHTML += `<tr><td>${dias[dia]}</td><td>${String(d).padStart(2,"0")}</td><td>${elegido}</td></tr>`;
 }
 localStorage.setItem("rotacion_idx",idx);
}

function guardar(){
 const titulo = document.getElementById("titulo").innerText;
 if(!titulo){ alert("Primero genere un memorándum"); return; }
 localStorage.setItem(titulo, document.getElementById("contenido").innerHTML);
 cargarLista();
 alert("Memorándum guardado");
}

function cargarLista(){
 const lista = document.getElementById("lista");
 lista.innerHTML = "";
 Object.keys(localStorage)
   .filter(k=>k.startsWith("MES DE"))
   .forEach(k=>{
     const li = document.createElement("li");
     li.innerHTML = `${k} 
       <button onclick="ver('${k}')">Ver</button>
       <button onclick="borrar('${k}')">Eliminar</button>`;
     lista.appendChild(li);
   });
}

function ver(k){
 document.getElementById("contenido").innerHTML = localStorage.getItem(k);
}

function borrar(k){
 if(confirm("¿Eliminar este memorándum?")){
   localStorage.removeItem(k);
   cargarLista();
 }
}

generar();
cargarLista();
</script>

</body>
</html>
