<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Controlador de Crías – Inspección 6ta Zona</title>
<style>
body { font-family: Arial, sans-serif; background:#f2f2f2; margin:0 }
header { background:#1f2a44; color:#fff; padding:20px; text-align:center }
.container { max-width:1100px; margin:auto; background:#fff; padding:25px }
.controls { display:flex; gap:10px; margin-bottom:15px; flex-wrap:wrap }
button { padding:6px 10px; cursor:pointer }
table { width:100%; border-collapse:collapse; margin-top:15px }
th,td { border:1px solid #000; padding:6px }
th { background:#e6e6e6 }
.memoria { border:1px solid #000; padding:12px; margin-bottom:20px }
.saved { margin-top:30px }
@media print {
  header,.controls,.saved { display:none }
}
</style>
</head>
<body>

<header>
<h2>CONTROLADOR DE COMISARÍAS</h2>
<h3>Inspección 6ta Zona</h3>
</header>

<div class="container" id="contenido">

<div class="controls">
<select id="mes">
<option value="0">Enero</option><option value="1">Febrero</option><option value="2">Marzo</option>
<option value="3">Abril</option><option value="4">Mayo</option><option value="5">Junio</option>
<option value="6">Julio</option><option value="7">Agosto</option><option value="8">Septiembre</option>
<option value="9">Octubre</option><option value="10">Noviembre</option><option value="11">Diciembre</option>
</select>
<input type="number" id="anio" value="2026">
<button onclick="generar()">Generar</button>
<button onclick="guardar()">Guardar</button>
<button onclick="exportarWord()">Exportar a Word</button>
<button onclick="window.print()">Imprimir / PDF</button>
</div>

<div class="memoria">
<b>MEMORANDUM</b><br><br>
SEÑORES JEFES DE: C.R.A.E.A.S., CRIA 27°, SUB CRIA 7°, SUB CRIA 9°, 
SUB CRIA 10°, SUB CRIA 11°, SUB CRIA 12°.<br><br>
Horario: 22:00 a 06:00 hs.
</div>

<h3 id="titulo"></h3>

<table>
<thead>
<tr><th>Día</th><th>Fecha</th><th>Dependencia</th></tr>
</thead>
<tbody id="tabla"></tbody>
</table>

<div class="saved">
<h3>Memorándums guardados</h3>
<ul id="lista"></ul>
</div>

</div>

<script>
const dependencias = [
 "CRIA 27","CREAS","SUB CRIA 7","SUB CRIA 9",
 "SUB CRIA 10","SUB CRIA 11","SUB CRIA 12"
];
const dias = ["Domingo","Lunes","Martes","Miércoles","Jueves","Viernes","Sábado"];

function generar(){
const prohibidasFinde = ["CRIA 27","C.R.A.E.A.S."];

 const mes = +mesSelect.value;
 const anio = +anioInput.value;
 tabla.innerHTML = "";
 const usados = {};
 dependencias.forEach(d=>usados[d]=new Set());

 let idx = parseInt(localStorage.getItem("rotacion_idx")) || 0;
 const total = new Date(anio,mes+1,0).getDate();
 const nombreMes = new Date(anio,mes).toLocaleString("es",{month:"long"}).toUpperCase();
 titulo.innerText = `MES DE ${nombreMes} ${anio}`;

 for(let d=1; d<=total; d++){
   const dow = new Date(anio,mes,d).getDay();

   const f = new Date(anio,mes,d);
   let dep;
   for(let i=0;i<dependencias.length;i++){
     const cand = dependencias[(idx+i)%dependencias.length];
     if(!usados[cand].has(f.getDay())){
       dep = cand;
       idx = (idx+i+1)%dependencias.length;
       break;
     }
   }
   usados[dep].add(f.getDay());
   tabla.innerHTML += `<tr>
     <td>${dias[f.getDay()]}</td>
     <td>${String(d).padStart(2,"0")}</td>
     <td>${dep}</td></tr>`;
 }

 localStorage.setItem("rotacion_idx", idx);
}

function guardar(){
 const key = titulo.innerText;
 localStorage.setItem(key, document.getElementById("contenido").innerHTML);
 cargarLista();
 alert("Memorándum guardado");
}

function cargarLista(){
 lista.innerHTML = "";
 Object.keys(localStorage).filter(k=>k.startsWith("MES")).forEach(k=>{
   lista.innerHTML += `<li>${k}
   <button onclick="ver('${k}')">Ver</button>
   <button onclick="borrar('${k}')">Borrar</button></li>`;
 });
}

function ver(k){
 document.getElementById("contenido").innerHTML = localStorage.getItem(k);
}

function borrar(k){
 if(confirm("¿Eliminar memorándum?")){
   localStorage.removeItem(k);
   cargarLista();
 }
}

function exportarWord(){
 const contenido = document.getElementById("contenido").innerHTML;
 const blob = new Blob([`
 <html><head><meta charset='UTF-8'></head><body>${contenido}</body></html>
 `], { type: "application/msword" });

 const a = document.createElement("a");
 a.href = URL.createObjectURL(blob);
 a.download = titulo.innerText + ".doc";
 a.click();
}

const mesSelect = document.getElementById("mes");
const anioInput = document.getElementById("anio");
const tabla = document.getElementById("tabla");
const titulo = document.getElementById("titulo");
const lista = document.getElementById("lista");

generar();
cargarLista();
</script>

</body>
</html>
