<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Generador semanal de servicios - Arroyo Seco</title>
  <style>
    body { font-family: Arial, sans-serif; background:#f4f6f8; padding:20px }
    h1 { color:#1f2937 }
    button { padding:8px 14px; font-size:15px; cursor:pointer; margin-right:5px }
    .box { background:#fff; padding:15px; border-radius:8px; box-shadow:0 2px 6px rgba(0,0,0,.1); margin-top:15px }
    pre { white-space:pre-wrap }
    label { font-weight: bold }
  </style>
</head>
<body>

<h1>ðŸ“‹ Generador semanal de servicios</h1>
<p>Funciona 100% local. Todo queda guardado aunque cierres el navegador.</p>

<label>ðŸ“… Fecha sÃ¡bado:
  <input type="date" id="fechaSabado">
</label>
<br><br>

<button id="btnGenerar">Generar</button>
<button onclick="guardarServicio()">Guardar</button>
<button id="btnLimpiar">Borrar todo</button>

<div class="box">
  <h3>ðŸ§¾ Servicio actual</h3>
  <pre id="resultado"></pre>
</div>

<div class="box">
  <h3>ðŸ—‚ Historial de servicios</h3>
  <div id="historial"></div>
</div>

<script>
const subCrias = [7, 9, 10, 11, 12];
let semana = parseInt(localStorage.getItem('semanaServicios')) || 0;
let historial = JSON.parse(localStorage.getItem('historialServicios')) || [];
let servicioActual = JSON.parse(localStorage.getItem('servicioActual')) || null;

document.getElementById('btnGenerar').onclick = generarServicio;
document.getElementById('btnLimpiar').onclick = limpiarTodo;

if (servicioActual) {
  document.getElementById('resultado').textContent = servicioActual.texto;
}
renderHistorial();

function generarServicio() {
  const fecha = document.getElementById('fechaSabado').value;
  if (!fecha) return alert('SeleccionÃ¡ un sÃ¡bado');

  if (historial.some(s => s.fecha === fecha)) {
    alert('âš  Ese servicio ya fue generado');
    return;
  }

  const f = new Date(fecha + 'T00:00:00');
  if (f.getDay() !== 6) return alert('La fecha no es sÃ¡bado');

  const opciones = { day:'2-digit', month:'2-digit', year:'numeric' };
  const sab = f.toLocaleDateString('es-AR', opciones);

  const dom = new Date(f);
  dom.setDate(dom.getDate() + 1);
  const domTxt = dom.toLocaleDateString('es-AR', opciones);

  const r = subCrias.slice(semana).concat(subCrias.slice(0, semana));

  servicioActual = {
    fecha,
    texto: `SERVICIO CUSTODIA - ARROYO SECO

ðŸ“Œ SÃBADO ${sab}
Sub CrÃ­a ${r[0]}

ðŸ“Œ DOMINGO ${domTxt} (maÃ±ana)
Sub CrÃ­as ${r[1]} y ${r[2]}

ðŸ“Œ DOMINGO ${domTxt} (noche)
Sub CrÃ­a ${r[3]}

âž¡ Descansa: Sub CrÃ­a ${r[4]}`
  };

  localStorage.setItem('servicioActual', JSON.stringify(servicioActual));
  document.getElementById('resultado').textContent = servicioActual.texto;
}

function guardarServicio() {
  if (!servicioActual) return alert('No hay servicio para guardar');

  historial.push(servicioActual);
  localStorage.setItem('historialServicios', JSON.stringify(historial));

  semana = (semana + 1) % subCrias.length;
  localStorage.setItem('semanaServicios', semana);

  servicioActual = null;
  localStorage.removeItem('servicioActual');
  document.getElementById('resultado').textContent = '';
  renderHistorial();
}

function renderHistorial() {
  const cont = document.getElementById('historial');
  cont.innerHTML = '';

  historial.forEach((s, i) => {
    const div = document.createElement('div');
    div.className = 'box';
    div.innerHTML = `
      <pre>${s.texto}</pre>
      <button onclick="eliminarServicio(${i})">ðŸ—‘ Eliminar</button>
    `;
    cont.appendChild(div);
  });
}

function eliminarServicio(i) {
  if (!confirm('Â¿Eliminar este servicio?')) return;
  historial.splice(i, 1);
  localStorage.setItem('historialServicios', JSON.stringify(historial));
  renderHistorial();
}

function limpiarTodo() {
  if (!confirm('Â¿Borrar todo?')) return;
  localStorage.clear();
  historial = [];
  semana = 0;
  servicioActual = null;
  document.getElementById('resultado').textContent = '';
  renderHistorial();
}
</script>

</body>
</html>
